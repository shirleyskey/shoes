<?phpif (!class_exists('UpiCRMAffiliate')) {    class UpiCRMAffiliate {        var $wpdb;        public function __construct() {            global $wpdb;            $this->wpdb = &$wpdb;        }        function show_leads_table_load_script() {            wp_register_script('upicrm_affiliate_datatables', 'https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js', array('jquery'), '1.0');            wp_register_script('upicrm_affiliate_datatables_responsive', 'https://cdn.datatables.net/responsive/2.2.5/js/dataTables.responsive.min.js', array('jquery'), '1.0');            wp_register_style('upicrm_affiliate_datatables_style', 'https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css', FALSE, '0.1');            wp_register_style('upicrm_affiliate_datatables_responsive_style', 'https://cdn.datatables.net/responsive/2.2.5/css/responsive.dataTables.min.css', FALSE, '0.1');        }        function show_leads_table($atts, $content) {                        ob_start();            $UpiCRMLeads = new UpiCRMLeads();            $UpiCRMUsers = new UpiCRMUsers();            $UpiCRMLeads = new UpiCRMLeads();            $UpiCRMFields = new UpiCRMFields();            $UpiCRMUIBuilder = new UpiCRMUIBuilder();            $UpiCRMFieldsMapping = new UpiCRMFieldsMapping();            $UpiCRMLeadsStatus = new UpiCRMLeadsStatus();            wp_enqueue_style('upicrm_affiliate_datatables_style');            wp_enqueue_style('upicrm_affiliate_datatables_responsive_style');            $wp_scripts = wp_scripts();            wp_enqueue_style('plugin_name-admin-ui-css',                    'http://ajax.googleapis.com/ajax/libs/jqueryui/' . $wp_scripts->registered['jquery-ui-core']->ver . '/themes/smoothness/jquery-ui.css',                    false,                    1.0,                    false);            wp_enqueue_script('upicrm_affiliate_datatables');            wp_enqueue_script('upicrm_affiliate_datatables_responsive');            wp_enqueue_script('jquery-ui-datepicker');                                    /*if (!is_rtl()) {                echo '               <style>div.dataTables_wrapper {        direction: rtl;    }    </style>';             echo get_locale();             http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/            }*/                        $langArr = upicrm_get_lang_arr();            $lang = $langArr[get_locale()];                        $err = false;            if ($UpiCRMUsers->get_permission() == 3) {                $field_on = @get_option('upicrm_affiliate_show_fields');                if (!$field_on) {                    $err = true;                }                $list_option = $UpiCRMUIBuilder->get_list_option();                if (!$list_option) {                    $err = true;                }                $getNamesMap = $UpiCRMFieldsMapping->get();                $getLeads = $UpiCRMLeads->get(0, 0, 0, 'DESC', 0, 0, 0, get_current_user_id());                                if (isset($atts['show']) && isset($atts['field'])) {                    foreach ($getLeads as $num => $leadObj) {                        $checkDate = $UpiCRMUIBuilder->lead_routing($leadObj, 'content', $atts['field'], $getNamesMap, true, true);                        $startMonth = date('Y-m-d', strtotime("first day of this month"));                        $endMonth = date('Y-m-d', strtotime("last day of this month"));                        $checkDate = $checkDate ? $checkDate : date('Y-m-d');                        if (($checkDate >= $startMonth) && ($checkDate <= $endMonth)) {                            if (strtolower($atts['show']) == "no_month") {                                unset($getLeads[$num]);                            }                        } else {                            if (strtolower($atts['show']) == "month") {                                unset($getLeads[$num]);                            }                        }                    }                }                if (!$getLeads) {                    $err = true;                }            } else {                $err = true;            }            if (!$err) {                include @get_upicrm_template_path('affiliates_table_shortcode');            } else {                _e('No leads to show', 'upicrm');             }            return ob_get_clean();        }                function affiliate_time_save() {            $this->wpdb->update(upicrm_db() . "leads", array("affiliate_time" => $_POST['affiliate_time']), array("lead_id" => (int)$_POST['lead_id']));            //print_r($_POST);            echo 1;            die();        }            }    }add_shortcode('upicrm_affiliate', array(new UpiCRMAffiliate, 'show_leads_table'));add_action('wp_enqueue_scripts', array(new UpiCRMAffiliate, 'show_leads_table_load_script'));add_action('wp_ajax_affiliate_time_save', array(new UpiCRMAffiliate, 'affiliate_time_save'));add_action('wp_ajax_nopriv_affiliate_time_save', array(new UpiCRMAffiliate, 'affiliate_time_save'));